# Application Configuration
spring:
  application:
    name: document-core-service

  # Deshabilitar default resource handling para evitar que /** sea tratado como recurso estático
  # Esto permite que los endpoints dinámicos (como /actuator, /api, etc.) sean manejados
  # correctamente por DispatcherServlet sin ser interceptados por ResourceHttpRequestHandler
  web:
    resources:
      add-mappings: false

  # Database Configuration
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:docflow}
    username: ${DB_USER:docflow}
    password: ${DB_PASSWORD:docflow_secret}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # JPA/Hibernate Configuration
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          time_zone: UTC

  # Multipart/File Upload Configuration
  servlet:
    multipart:
      enabled: true
      max-file-size: 500MB
      max-request-size: 500MB
      file-size-threshold: 2KB

# Server Configuration
server:
  port: 8082
  servlet:
    context-path: /

# SpringDoc OpenAPI Configuration
springdoc:
  api-docs:
    enabled: true
    path: /api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
  info:
    title: Document Core Service API
    description: Document Core Service for DocFlow - Document Management
    version: 0.0.1-SNAPSHOT
    contact:
      name: DocFlow Team

# Spring Boot Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# Logging Configuration
logging:
  level:
    root: INFO
    com.docflow.documentcore: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# DocFlow Custom Configuration
docflow:
  storage:
    # Tipo de almacenamiento: 'local' (desarrollo) o 'minio' (producción)
    # Por defecto: 'minio' (usar DOCFLOW_STORAGE_TYPE=local para desarrollo)
    type: ${DOCFLOW_STORAGE_TYPE:minio}
    
    local:
      path: ${DOCFLOW_STORAGE_PATH:./storage}
    
    # MinIO Configuration (almacenamiento por defecto)
    # Endpoint debe estar accesible desde el servicio
    # En Docker: http://minio:9000
    # En local: http://localhost:9000
    minio:
      endpoint: ${DOCFLOW_STORAGE_MINIO_ENDPOINT:http://localhost:9000}
      access-key: ${DOCFLOW_STORAGE_MINIO_ACCESS_KEY:minioadmin}
      secret-key: ${DOCFLOW_STORAGE_MINIO_SECRET_KEY:minioadmin123}
      bucket-name: ${DOCFLOW_STORAGE_MINIO_BUCKET_NAME:docflow-documents}
